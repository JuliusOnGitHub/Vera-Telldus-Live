<?xml version="1.0"?>
<implementation>
  <files>L_TellstickNet.lua</files>
  <startup>lug_startup</startup>
  <actionList>
    <action>
      <serviceId>urn:upnp-org:serviceId:SwitchPower1</serviceId>
      <name>SetTarget</name>
      <run>
		luup.log("SetTarget for telldus device: " .. lul_settings.newTargetValue)
		if(lul_settings.newTargetValue == "1") then
			deviceCommand(luup.devices[lul_device].id, "turnOn")
		else
			deviceCommand(luup.devices[lul_device].id, "turnOff")
		end
		
		luup.variable_set("urn:upnp-org:serviceId:SwitchPower1", "Status", lul_settings.newTargetValue, lul_device)
		
		return true
      </run>
    </action>
    <action>
      <serviceId>urn:upnp-org:serviceId:Dimming1</serviceId>
      <name>SetLoadLevelTarget</name>
      <run>
		luup.log("Set dim level for telldus device: " .. lul_settings.newLoadlevelTarget)
		
		if(lul_settings.newLoadlevelTarget == "0") then
			deviceCommand(luup.devices[lul_device].id, "turnOff")
			luup.variable_set("urn:upnp-org:serviceId:Dimming1", "LoadLevelTarget", lul_settings.newLoadlevelTarget, lul_device)
		else
			setDimLevel(luup.devices[lul_device].id, lul_settings.newLoadlevelTarget)
			luup.variable_set("urn:upnp-org:serviceId:Dimming1", "LoadLevelTarget", lul_settings.newLoadlevelTarget, lul_device)
		end

		
		return true
      </run>
    </action>
	<action>
      <serviceId>urn:micasaverde-com:serviceId:HaDevice1</serviceId>
      <name>Poll</name>
      <run>
        task("Telldus sensor sync start", TASK_BUSY)
        -- Force refreshCache to get called in a Timer
        luup.call_timer("refreshCache", 1, "1", "")
      </run>
	  </action>	
  </actionList>  
</implementation>
